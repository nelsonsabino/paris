    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-database-compat.js"></script>
    <script>
        // --- CÓDIGO JAVASCRIPT COMPLETO E CORRIGIDO ---
        const countdownDate = new Date(2025, 8, 19, 6, 0, 0).getTime();
        const x = setInterval(function() {
            const now = new Date().getTime();
            const distance = countdownDate - now;
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            if (document.getElementById("days")) {
                document.getElementById("days").innerText = days.toString().padStart(2, '0');
                document.getElementById("hours").innerText = hours.toString().padStart(2, '0');
                document.getElementById("minutes").innerText = minutes.toString().padStart(2, '0');
                document.getElementById("seconds").innerText = seconds.toString().padStart(2, '0');
            }
            if (distance < 0) {
                clearInterval(x);
                if (document.getElementById("countdown")) {
                    document.getElementById("countdown").innerHTML = "<div class='text-center w-full'><p class='text-2xl font-bold'>A VIAGEM COMEÇOU! BON VOYAGE!</p></div>";
                }
            }
        }, 1000);
        
        const firebaseConfig = {
          apiKey: "AIzaSyAt7jAk5r2tqSdyTf2m7MUebd_t7bbDTJk",
          authDomain: "planeamento-viagem-paris.firebaseapp.com",
          databaseURL: "https://planeamento-viagem-paris-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "planeamento-viagem-paris",
          storageBucket: "planeamento-viagem-paris.appspot.com",
          messagingSenderId: "121000897121",
          appId: "1:121000897121:web:75662c01dc56926bf61820"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        const planningEvents = [
            { title: 'Comprar bilhetes para o Museu do Louvre', date: '2025-06-18', description: 'Comprar para o dia 22 de Setembro (Segunda-feira).', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Museu D Orsay', date: '2025-06-21', description: 'Em principio em julho já é possivel comprar os bilhetes. Verificar disponibilidade.', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para Versailles', date: '2025-06-23', description: 'A partir desta data já é possivel comprar para o dia 21 de setembro.', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Sainte-Chapelle', date: '2025-07-01', description: 'Em principio em julho já é possivel comprar os bilhetes. Verificar disponibilidade.', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Torre Eiffel', date: '2025-07-20', description: 'Comprar ás 23h!! (0.00h em Paris) Os bilhetes ficam disponíveis 60 dias antes. Comprar para o dia 19 de Setembro (Sexta-feira).', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Ópera Garnier', date: '2025-07-23', description: 'Fazer a compra ás 23h!! Comprar para o dia 22 de Setembro (Segunda-feira).', status: 'complete', color: '#16a34a' },
            { title: 'Fazer pagamento da casa de Paris', date: '2025-08-25', description: 'Fazer o pagamento final da reserva.', status: 'pending', color: '#ea580c' },
            { title: 'Reserva para entrada sem filas na Notre-Dame', date: '2025-09-19', description: 'A reserva só pode ser feita umas horas antes. Irá ser dificil apanhar um slot disponível.', status: 'pending', color: '#ea580c' },
            { title: 'VIAGEM!', date: '2025-09-19', endDate: '2025-09-24', description: 'De 19 a 23 de Setembro.', status: 'complete', color: '#16a34a' }
        ];
        
        const tripItinerary = [
            { day: 'Dia 1', date: '19/09', theme: 'Chegada e Torre Eiffel', ticketedVenues: [ { name: 'Torre Eiffel', icon: 'fa-tower-observation', status: 'complete', openingHours: '09:00 - 23:45', openDays: 'Todos os dias' }] },
            { day: 'Dia 2', date: '20/09', theme: 'Coração Histórico', ticketedVenues: [ { name: 'Musée dOrsay', icon: 'fa-gem', status: 'complete', openingHours: '09:00 - 17:00', openDays: 'Todos os dias (verificar feriados)' }] },
            { day: 'Dia 3', date: '21/09', theme: 'Realeza e Arte Boémia', ticketedVenues: [ { name: 'Palácio de Versalhes', icon: 'fa-crown', status: 'complete', openingHours: '09:00 - 18:30 (Palácio)', openDays: 'Fecha às Segundas' }] },
            { day: 'Dia 4', date: '22/09', theme: 'Imersão em Arte', ticketedVenues: [ { name: 'Museu do Louvre', icon: 'fa-landmark-dome', status: 'complete', openingHours: '09:00 - 18:00', openDays: 'Fecha às Terças' }, { name: 'Ópera Garnier', icon: 'fa-masks-theater', status: 'complete', openingHours: '10:00 - 17:00', openDays: 'Todos os dias (pode fechar para eventos)' }] },
            { day: 'Dia 5', date: '23/09', theme: 'Despedida e Regresso', ticketedVenues: [ { name: 'Sainte-Chapelle', icon: 'fa-gem', status: 'complete', openingHours: '09:00 - 17:00', openDays: 'Todos os dias (verificar feriados)' } ] }
        ];

        function setupChecklist() {
            const checklistItems = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const checklistRef = database.ref('checklist');
            checklistRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) { checklistItems.forEach(item => { if (data[item.id] !== undefined) { item.checked = data[item.id]; } }); }
            });
            checklistItems.forEach(item => { item.addEventListener('change', (e) => { checklistRef.child(e.target.id).set(e.target.checked); }); });
        }
        
        function renderTimeline() {
            const timelineContainer = document.getElementById('timeline-container');
            if (!timelineContainer) return;
            timelineContainer.innerHTML = '';
            planningEvents.forEach(event => {
                if (event.title === 'VIAGEM!') return;
                const eventDate = new Date(event.date + 'T00:00:00');
                const month = eventDate.toLocaleString('pt-PT', { month: 'short' }).toUpperCase().replace('.', '');
                const day = eventDate.getDate();
                const isComplete = event.status === 'complete';
                const itemHTML = `<div class="flex items-start space-x-4 ${isComplete ? 'opacity-60' : ''}"><div class="flex flex-col items-center"><span class="text-lg font-semibold ${isComplete ? 'text-gray-500' : 'text-green-700'}">${month}</span><span class="text-2xl font-bold ${isComplete ? 'text-gray-500' : 'text-green-700'}">${day}</span></div><div class="bg-white p-4 rounded-lg shadow-md flex-1"><h3 class="font-semibold text-lg ${isComplete ? 'line-through' : ''}">${event.title}</h3><p class="text-sm text-gray-600">${event.description}</p><div class="mt-2 text-sm font-medium ${isComplete ? 'text-green-600' : 'text-yellow-600'}"><i class="fa-solid ${isComplete ? 'fa-check-circle' : 'fa-hourglass-half'} mr-2"></i>${isComplete ? 'Concluído' : 'Pendente'}</div></div></div>`;
                timelineContainer.innerHTML += itemHTML;
            });
        }

        function renderCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (!calendarEl) return;
            const modal = document.getElementById('event-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalDescription = document.getElementById('modal-description');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const calendarEvents = planningEvents.map(event => ({ title: event.title, start: event.date, end: event.endDate, backgroundColor: event.color, borderColor: event.color, allDay: true, extendedProps: { description: event.description || 'Não há detalhes adicionais.' } }));
            const calendar = new FullCalendar.Calendar(calendarEl, { initialView: 'dayGridMonth', locale: 'pt-br', headerToolbar: { left: 'prev,next today', center: 'title', right: '' }, events: calendarEvents, eventClick: function(info) { info.jsEvent.preventDefault(); if(modal) { modalTitle.textContent = info.event.title; modalDescription.textContent = info.event.extendedProps.description; modal.classList.remove('hidden');} } });
            function closeModal() { if(modal) modal.classList.add('hidden'); }
            if(modalCloseBtn) modalCloseBtn.addEventListener('click', closeModal);
            if(modal) modal.addEventListener('click', function(e) { if (e.target === modal) { closeModal(); } });
            calendar.render();
        }

        function renderTicketTimeline() {
            const container = document.getElementById('ticket-timeline-container');
            if (!container) return;
            container.innerHTML = '';
            tripItinerary.forEach(day => {
                let venuesHTML = '';
                if (day.ticketedVenues.length > 0) {
                    venuesHTML = `<ul class="mt-3 space-y-4">` + day.ticketedVenues.map(venue => {
                        const isComplete = venue.status === 'complete';
                        return `
                        <li class="p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fa-solid ${isComplete ? 'fa-check-circle text-green-500' : 'fa-hourglass-half text-yellow-500'} w-6 text-center mr-3"></i>
                                    <span class="font-semibold ${isComplete ? 'line-through text-gray-400' : 'text-gray-800'}">${venue.name}</span>
                                </div>
                                <i class="fa-solid ${venue.icon} text-xl text-gray-400"></i>
                            </div>
                            <div class="mt-2 pl-9 text-sm text-gray-600 space-y-1">
                                <div class="flex items-start"><i class="fa-regular fa-calendar-days w-6 text-center mr-1 pt-1"></i><span>${venue.openDays || 'Não especificado'}</span></div>
                                <div class="flex items-start"><i class="fa-regular fa-clock w-6 text-center mr-1 pt-1"></i><span>${venue.openingHours || 'Não especificado'}</span></div>
                            </div>
                        </li>`;
                    }).join('') + `</ul>`;
                } else {
                    venuesHTML = `<p class="mt-2 text-gray-500 italic">Nenhum bilhete a comprar para este dia.</p>`;
                }
                const dayHTML = `
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <div class="flex items-center border-b pb-3">
                            <div class="text-center w-16"><p class="text-xl font-bold text-gray-800">${day.day}</p><p class="text-sm text-gray-500">${day.date}</p></div>
                            <div class="pl-4 border-l ml-4"><h4 class="font-semibold text-lg text-gray-900">${day.theme}</h4></div>
                        </div>
                        ${venuesHTML}
                    </div>`;
                container.innerHTML += dayHTML;
            });
        }
        
        const tripStartDate = new Date('2025-09-19T12:00:00Z');
        const fetchTripWeather = async () => {
            const today = new Date();
            const daysUntilTrip = Math.ceil((tripStartDate - today) / (1000 * 60 * 60 * 24));
            let apiUrl;
            let title;
            if (daysUntilTrip > 16) {
                title = "Previsão Histórica (com base no ano passado)";
                apiUrl = `https://archive-api.open-meteo.com/v1/archive?latitude=48.8566&longitude=2.3522&start_date=2024-09-19&end_date=2024-09-23&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Europe/Paris`;
            } else {
                title = "Previsão da Viagem";
                apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=48.8566&longitude=2.3522&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Europe/Paris&start_date=2025-09-19&end_date=2025-09-23`;
            }
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`Erro na API: ${response.statusText}`);
                const data = await response.json();
                renderForecast(data, title);
            } catch (error) {
                console.error("Erro ao buscar dados da meteorologia:", error);
                document.getElementById('forecast-widget').innerHTML = `<h2 class="section-title font-bold text-gray-800 mb-4 text-center">Previsão da Viagem</h2><p class="text-red-500 text-center">Não foi possível carregar a previsão.</p>`;
            }
        };

        const getWeatherIcon = (code) => {
            const icons = { 0: 'fa-sun', 1: 'fa-cloud-sun', 2: 'fa-cloud-sun', 3: 'fa-cloud', 45: 'fa-smog', 48: 'fa-smog', 51: 'fa-cloud-rain', 53: 'fa-cloud-rain', 55: 'fa-cloud-rain', 61: 'fa-cloud-showers-heavy', 63: 'fa-cloud-showers-heavy', 65: 'fa-cloud-showers-heavy', 80: 'fa-cloud-sun-rain', 81: 'fa-cloud-sun-rain', 82: 'fa-cloud-sun-rain', 95: 'fa-bolt' };
            return icons[code] || 'fa-question-circle';
        };
        
        const formatDayAndDate = (dateObject) => {
            const day = dateObject.toLocaleDateString('pt-PT', { weekday: 'short' });
            const dayOfMonth = dateObject.getDate();
            return `${day} ${dayOfMonth}`;
        };

        const renderForecast = (data, title) => {
            const widget = document.getElementById('forecast-widget');
            const daily = data.daily;
            let forecastHtml = '';
            for (let i = 0; i < daily.time.length; i++) {
                const displayDate = new Date(tripStartDate);
                displayDate.setDate(tripStartDate.getDate() + i);
                forecastHtml += `<div class="text-center p-3 bg-gray-100 rounded-lg"><p class="font-semibold">${formatDayAndDate(displayDate)}</p><i class="fa-solid ${getWeatherIcon(daily.weather_code[i])} text-3xl my-2 text-blue-500"></i><p class="text-sm"><span class="font-bold text-red-500">${Math.round(daily.temperature_2m_max[i])}°</span> / <span class="text-blue-600">${Math.round(daily.temperature_2m_min[i])}°</span></p></div>`;
            }
            const widgetHtml = `<h2 class="section-title font-bold text-gray-800 mb-4 text-center">${title}</h2><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">${forecastHtml}</div>`;
            widget.innerHTML = widgetHtml;
        };

        document.addEventListener('DOMContentLoaded', () => {
            setupChecklist();
            renderTimeline();
            renderCalendar();
            renderTicketTimeline();
            fetchTripWeather();
        });
    </script>

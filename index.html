<!DOCTYPE html>
<html lang="pt">
<head>
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#facc15" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon para diferentes browsers -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <title>Planeamento: Viagem a Paris 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core/locales/pt-br.global.min.js'></script>
    
    <style>
        /* CSS para a Galeria de Destaques */
        .highlight-card {
            aspect-ratio: 1 / 1;
        }
        .highlight-card.col-span-2 {
            aspect-ratio: 2 / 1;
        }
    
        /* Estilos base (para telemóveis) */
        body { font-family: 'Poppins', sans-serif; background-color: #f0f4f8; font-size: 14px; }
        .main-title { font-size: 2rem; line-height: 2.5rem; }
        .section-title { font-size: 1.5rem; line-height: 2rem; }
        .countdown-number { font-size: 2.25rem; }

        /* Regras para ecrãs maiores (md: 768px em diante) */
        @media (min-width: 768px) {
            body { font-size: 16px; }
            .main-title { font-size: 3rem; line-height: 1; }
            .section-title { font-size: 1.875rem; line-height: 2.25rem; }
            .countdown-number { font-size: 2.25rem; }
        }
        .checklist-item input:checked + label { text-decoration: line-through; color: #9ca3af; }
        .checklist-item input:checked + label .icon-box { background-color: #16a34a; color: white; }
    </style>
</head>
<body class="text-gray-800">
    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center py-12 rounded-2xl shadow-lg mb-12 bg-cover bg-center" style="background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8cGFyaXN8ZW58MHx8MHx8fDA%D');">
            <h1 class="main-title font-bold text-white mb-4">Rumo a Paris!</h1>
            <p class="text-lg text-gray-200 mb-6">A nossa aventura aproxima-se...</p>
            <div id="countdown" class="flex justify-center space-x-4 md:space-x-8 text-white">
                <div><span id="days" class="countdown-number font-bold">00</span><span class="block text-sm">Dias</span></div>
                <div><span id="hours" class="countdown-number font-bold">00</span><span class="block text-sm">Horas</span></div>
                <div><span id="minutes" class="countdown-number font-bold">00</span><span class="block text-sm">Minutos</span></div>
                <div><span id="seconds" class="countdown-number font-bold">00</span><span class="block text-sm">Segundos</span></div>
            </div>
        </header>

        <section id="weather-widget" class="bg-white p-6 rounded-2xl shadow-lg mb-12 text-center">
            <p class="text-gray-500">A carregar meteorologia para Paris...</p>
        </section>

        <section class="mb-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <a href="guia.html" class="block bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:scale-105 transition-transform duration-300">
                    <div class="flex items-center text-green-800 mb-3"><i class="fa-solid fa-map-location-dot text-2xl mr-3"></i><h3 class="text-xl font-bold">Guia Visual</h3></div>
                    <p class="text-gray-600">O nosso plano com imagens, curiosidades e destaques.</p>
                </a>
                <a href="roteiro.html" class="block bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:scale-105 transition-transform duration-300">
                     <div class="flex items-center text-blue-800 mb-3"><i class="fa-solid fa-list-ol text-2xl mr-3"></i><h3 class="text-xl font-bold">Roteiro Detalhado</h3></div>
                    <p class="text-gray-600">A versão com horários, transportes e todas as informações.</p>
                </a>
                <a href="orcamento.html" class="block bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:scale-105 transition-transform duration-300">
                     <div class="flex items-center text-red-800 mb-3"><i class="fa-solid fa-euro-sign text-2xl mr-3"></i><h3 class="text-xl font-bold">Orçamento Detalhado</h3></div>
                    <p class="text-gray-600">Consulta os custos estimados por grupo e bilhetes.</p>
                </a>
             </div>
        </section>
        <section class="mb-12">
            <h2 class="section-title font-bold text-gray-800 mb-6 text-center">Próximos Passos</h2>
            <div id="timeline-container" class="space-y-8"></div>
        </section>
        
        <section class="mb-12">
            <h2 class="section-title font-bold text-gray-800 mb-6 text-center">Guias da Nossa Viagem</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                
                <a href="visita_torre-eiffel.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg col-span-2"><img src="https://res.cloudinary.com/dtljonz0f/image/upload/f_auto/q_auto/v1/gc-v1/paris/3%20giorni%20a%20Parigi%20Tour%20Eiffel?_a=BAVAZGE70" alt="Torre Eiffel" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-xl font-bold">Torre Eiffel</h3></a>
                <a href="visita_louvre.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://www.relaisdulouvre.com/wp-content/uploads/2024/03/Louvre1-1024x682.jpg" alt="Museu do Louvre" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Museu do Louvre</h3></a>
                <a href="visita_versalhes.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://paisageiro.com/wp-content/uploads/2023/03/organizacao-jardins-de-versalhes1-1024x683.jpg" alt="Palácio de Versalhes" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Palácio de Versalhes</h3></a>
                
                <a href="visita_notre-dame.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg col-span-2"><img src="https://images.adsttc.com/media/images/671f/6aa2/3dfd/b479/8aac/78a7/large_jpg/notre-dame-de-paris-announces-reopening-date-and-proposes-constroversial-entrance-fee_2.jpg?1730112234" alt="Catedral de Notre-Dame" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-xl font-bold">Catedral de Notre-Dame</h3></a>
                <a href="visita_sainte-chapelle.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://www.timographie360.fr/photos/realisations/sliders/hd/visite-virtuelle-sainte-chapelle-02_518.jpg" alt="Sainte-Chapelle" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Sainte-Chapelle</h3></a>
                <a href="visita_montmartre.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://www.civitatis.com/f/francia/paris/free-tour-montmartre-589x392.jpg" alt="Montmartre" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Montmartre</h3></a>
                
                <a href="visita_musee-orsay.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://officiel-galeries-musees.fr/wp-content/uploads/2020/08/orsay-musee.jpg" alt="Musée d'Orsay" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Musée d'Orsay</h3></a>
                <a href="visita_champs-elysees.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://www.tudosobreparis.com/f/francia/paris/guia/campos-eliseos-m.jpg" alt="Champs-Élysées" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Champs-Élysées</h3></a>
                <a href="visita_galeries-lafayette.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://www.franceguide.info/wp-content/uploads/sites/18/paris-galeries-lafayette.jpg" alt="Galeries Lafayette" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Galeries Lafayette</h3></a>
                <a href="visita_quartier-latin.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://midias-turismo.eurodicas.com.br/wp-content/uploads/2025/02/quartier-latin-1-1200x800.jpg.webp" alt="Quartier Latin" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Quartier Latin</h3></a>
                
                <a href="visita_opera-garnier.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://imgmd.net/images/v1/guia/1704274/opera-garnier.jpg" alt="Ópera Garnier" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Ópera Garnier</h3></a>
                <a href="visita_arco-do-triunfo.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg"><img src="https://images.mnstatic.com/61/40/614037e83d114c30b06f7eecee55ff80.jpg" alt="Arco do Triunfo" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-lg font-bold">Arco do Triunfo</h3></a>
                <a href="visita_jardim-luxemburgo.html" class="highlight-card group block relative rounded-2xl overflow-hidden shadow-lg col-span-2"><img src="https://www.eutouring.com/images_paris_jardin_du_luxembourg_18.jpeg" alt="Jardim do Luxemburgo" class="absolute w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"><div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div><h3 class="absolute bottom-4 left-4 text-white text-xl font-bold">Jardim do Luxemburgo</h3></a>

            </div>
        </section>        
        
        <section class="mb-12">
            <h2 class="section-title font-bold text-gray-800 mb-6 text-center">Calendário</h2>
            <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg">
                <div id='calendar'></div>
            </div>
        </section>
        <section class="mb-12">
            <h2 class="section-title font-bold text-gray-800 mb-6 text-center">Checklist de Preparação</h2>
            <div class="bg-white p-6 rounded-2xl shadow-lg space-y-4">
                <div class="checklist-item flex items-center"><input type="checkbox" id="check-aviao" class="hidden"><label for="check-aviao" class="flex items-center cursor-pointer w-full"><span class="icon-box w-8 h-8 mr-4 flex items-center justify-center border-2 border-gray-300 rounded-md transition-colors"><i class="fa-solid fa-check"></i></span><span class="text-lg">Reservar voos</span></label></div>
                <div class="checklist-item flex items-center"><input type="checkbox" id="check-alojamento" class="hidden"><label for="check-alojamento" class="flex items-center cursor-pointer w-full"><span class="icon-box w-8 h-8 mr-4 flex items-center justify-center border-2 border-gray-300 rounded-md transition-colors"><i class="fa-solid fa-check"></i></span><span class="text-lg">Reservar alojamento</span></label></div>
                <div class="checklist-item flex items-center"><input type="checkbox" id="check-mochilas" class="hidden"><label for="check-mochilas" class="flex items-center cursor-pointer w-full"><span class="icon-box w-8 h-8 mr-4 flex items-center justify-center border-2 border-gray-300 rounded-md transition-colors"><i class="fa-solid fa-check"></i></span><span class="text-lg">Compra de mochilas</span></label></div>
                <div class="checklist-item flex items-center"><input type="checkbox" id="check-seguro" class="hidden"><label for="check-seguro" class="flex items-center cursor-pointer w-full"><span class="icon-box w-8 h-8 mr-4 flex items-center justify-center border-2 border-gray-300 rounded-md transition-colors"><i class="fa-solid fa-check"></i></span><span class="text-lg">Todos têm cartões de saúde europeus?</span></label></div>
                <div class="checklist-item flex items-center"><input type="checkbox" id="check-transportes" class="hidden"><label for="check-transportes" class="flex items-center cursor-pointer w-full"><span class="icon-box w-8 h-8 mr-4 flex items-center justify-center border-2 border-gray-300 rounded-md transition-colors"><i class="fa-solid fa-check"></i></span><span class="text-lg">Bilhetes transportes públicos</span></label></div>
            </div>
        </section>
        
        <section class="mb-12">
            <h2 class="section-title font-bold text-gray-800 mb-6 text-center">Resumo de Bilhetes a comprar</h2>
            <div id="ticket-timeline-container" class="space-y-6"></div>
        </section>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-database-compat.js"></script>
    <script>
        // --- CÓDIGO JAVASCRIPT EXISTENTE ---
        const countdownDate = new Date(2025, 8, 19, 6, 0, 0).getTime();
        const x = setInterval(function() {
            const now = new Date().getTime();
            const distance = countdownDate - now;
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            if (document.getElementById("days")) {
                document.getElementById("days").innerText = days.toString().padStart(2, '0');
                document.getElementById("hours").innerText = hours.toString().padStart(2, '0');
                document.getElementById("minutes").innerText = minutes.toString().padStart(2, '0');
                document.getElementById("seconds").innerText = seconds.toString().padStart(2, '0');
            }
            if (distance < 0) {
                clearInterval(x);
                if (document.getElementById("countdown")) {
                    document.getElementById("countdown").innerHTML = "<div class='text-center w-full'><p class='text-2xl font-bold'>A VIAGEM COMEÇOU! BON VOYAGE!</p></div>";
                }
            }
        }, 1000);
        
        const firebaseConfig = {
          apiKey: "AIzaSyAt7jAk5r2tqSdyTf2m7MUebd_t7bbDTJk",
          authDomain: "planeamento-viagem-paris.firebaseapp.com",
          databaseURL: "https://planeamento-viagem-paris-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "planeamento-viagem-paris",
          storageBucket: "planeamento-viagem-paris.appspot.com",
          messagingSenderId: "121000897121",
          appId: "1:121000897121:web:75662c01dc56926bf61820"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        const planningEvents = [
            { title: 'Comprar bilhetes para o Museu do Louvre', date: '2025-06-18', description: 'Comprar para o dia 22 de Setembro (Segunda-feira).', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Museu D Orsay', date: '2025-06-21', description: 'Em principio em julho já é possivel comprar os bilhetes. Verificar disponibilidade.', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para Versailles', date: '2025-06-23', description: 'A partir desta data já é possivel comprar para o dia 21 de setembro.', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Sainte-Chapelle', date: '2025-07-01', description: 'Em principio em julho já é possivel comprar os bilhetes. Verificar disponibilidade.', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Torre Eiffel', date: '2025-07-20', description: 'Comprar ás 23h!! (0.00h em Paris) Os bilhetes ficam disponíveis 60 dias antes. Comprar para o dia 19 de Setembro (Sexta-feira).', status: 'complete', color: '#16a34a' },
            { title: 'Comprar bilhetes para a Ópera Garnier', date: '2025-07-23', description: 'Fazer a compra ás 23h!! Comprar para o dia 22 de Setembro (Segunda-feira).', status: 'complete', color: '#16a34a' },
            { title: 'Fazer pagamento da casa de Paris', date: '2025-08-25', description: 'Fazer o pagamento final da reserva.', status: 'pending', color: '#ea580c' },
            { title: 'Reserva para entrada sem filas na Notre-Dame', date: '2025-09-19', description: 'A reserva só pode ser feita umas horas antes. Irá ser dificil apanhar um slot disponível.', status: 'pending', color: '#ea580c' },
            { title: 'VIAGEM!', date: '2025-09-19', endDate: '2025-09-24', description: 'De 19 a 23 de Setembro.', status: 'complete', color: '#16a34a' }
        ];
        
        const tripItinerary = [
            { day: 'Dia 1', date: '19/09', theme: 'Chegada e Torre Eiffel', ticketedVenues: [ { name: 'Torre Eiffel', icon: 'fa-tower-observation', status: 'complete', openingHours: '09:00 - 23:45', openDays: 'Todos os dias' }] },
            { day: 'Dia 2', date: '20/09', theme: 'Coração Histórico', ticketedVenues: [ { name: 'Musée dOrsay', icon: 'fa-gem', status: 'complete', openingHours: '09:00 - 17:00', openDays: 'Todos os dias (verificar feriados)' }] },
            { day: 'Dia 3', date: '21/09', theme: 'Realeza e Arte Boémia', ticketedVenues: [ { name: 'Palácio de Versalhes', icon: 'fa-crown', status: 'complete', openingHours: '09:00 - 18:30 (Palácio)', openDays: 'Fecha às Segundas' }] },
            { day: 'Dia 4', date: '22/09', theme: 'Imersão em Arte', ticketedVenues: [ { name: 'Museu do Louvre', icon: 'fa-landmark-dome', status: 'complete', openingHours: '09:00 - 18:00', openDays: 'Fecha às Terças' }, { name: 'Ópera Garnier', icon: 'fa-masks-theater', status: 'complete', openingHours: '10:00 - 17:00', openDays: 'Todos os dias (pode fechar para eventos)' }] },
            { day: 'Dia 5', date: '23/09', theme: 'Despedida e Regresso', ticketedVenues: [ { name: 'Sainte-Chapelle', icon: 'fa-gem', status: 'complete', openingHours: '09:00 - 17:00', openDays: 'Todos os dias (verificar feriados)' } ] }
        ];

        function setupChecklist() { /* ... */ }
        function renderTimeline() { /* ... */ }
        function renderCalendar() { /* ... */ }
        function renderTicketTimeline() { /* ... */ }

        // --- CÓDIGO METEOROLOGIA (OPEN-METEO) ---
        const fetchWeather = async () => {
            const lat = 48.8566; const lon = 2.3522;
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}¤t=temperature_2m,weather_code,is_day&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Europe/Paris&forecast_days=5`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Erro na API: ${response.statusText}`);
                const data = await response.json();
                renderWeather(data);
            } catch (error) {
                console.error("Erro ao buscar dados da meteorologia:", error);
                document.getElementById('weather-widget').innerHTML = '<p class="text-red-500">Não foi possível carregar a meteorologia.</p>';
            }
        };

        const getWeatherIcon = (code, isDay = 1) => {
            const icons = { 0: { day: 'fa-sun', night: 'fa-moon' }, 1: { day: 'fa-cloud-sun', night: 'fa-cloud-moon' }, 2: { day: 'fa-cloud-sun', night: 'fa-cloud-moon' }, 3: { day: 'fa-cloud', night: 'fa-cloud' }, 45: { day: 'fa-smog', night: 'fa-smog' }, 48: { day: 'fa-smog', night: 'fa-smog' }, 51: { day: 'fa-cloud-rain', night: 'fa-cloud-rain' }, 53: { day: 'fa-cloud-rain', night: 'fa-cloud-rain' }, 55: { day: 'fa-cloud-rain', night: 'fa-cloud-rain' }, 61: { day: 'fa-cloud-showers-heavy', night: 'fa-cloud-showers-heavy' }, 63: { day: 'fa-cloud-showers-heavy', night: 'fa-cloud-showers-heavy' }, 65: { day: 'fa-cloud-showers-heavy', night: 'fa-cloud-showers-heavy' }, 80: { day: 'fa-cloud-sun-rain', night: 'fa-cloud-moon-rain' }, 81: { day: 'fa-cloud-sun-rain', night: 'fa-cloud-moon-rain' }, 82: { day: 'fa-cloud-sun-rain', night: 'fa-cloud-moon-rain' }, 95: { day: 'fa-bolt', night: 'fa-bolt' }, };
            const iconSet = icons[code] || { day: 'fa-question-circle', night: 'fa-question-circle' };
            return isDay ? iconSet.day : iconSet.night;
        };
        
        const getWeatherDescription = (code) => {
             const descriptions = { 0: 'Céu limpo', 1: 'Quase limpo', 2: 'Parcialmente nublado', 3: 'Nublado', 45: 'Nevoeiro', 48: 'Nevoeiro com gelo', 51: 'Chuvisco leve', 53: 'Chuvisco', 55: 'Chuvisco forte', 61: 'Chuva fraca', 63: 'Chuva', 65: 'Chuva forte', 80: 'Aguaceiros fracos', 81: 'Aguaceiros', 82: 'Aguaceiros fortes', 95: 'Trovoada' };
            return descriptions[code] || 'Não disponível';
        };

        const formatDay = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-PT', { weekday: 'short' });
        };

        const renderWeather = (data) => {
            const widget = document.getElementById('weather-widget');
            const current = data.current;
            const daily = data.daily;
            let forecastHtml = '';
            for (let i = 1; i < 5; i++) {
                forecastHtml += `<div class="text-center p-2 bg-gray-100 rounded-lg"><p class="font-semibold">${formatDay(daily.time[i])}</p><i class="fa-solid ${getWeatherIcon(daily.weather_code[i])} text-2xl my-2 text-yellow-500"></i><p class="text-sm"><span class="font-bold">${Math.round(daily.temperature_2m_max[i])}°</span> / ${Math.round(daily.temperature_2m_min[i])}°</p></div>`;
            }
            const widgetHtml = `<div class="flex flex-col md:flex-row items-center justify-between gap-6"><div class="flex items-center gap-4"><i class="fa-solid ${getWeatherIcon(current.weather_code, current.is_day)} text-5xl text-blue-500"></i><div><p class="text-3xl font-bold">${Math.round(current.temperature_2m)}°C</p><p class="text-gray-600 capitalize">${getWeatherDescription(current.weather_code)}</p></div></div><div class="grid grid-cols-4 gap-3 w-full md:w-auto">${forecastHtml}</div></div>`;
            widget.innerHTML = widgetHtml;
        };

        document.addEventListener('DOMContentLoaded', () => {
            setupChecklist(); renderTimeline(); renderCalendar(); renderTicketTimeline(); fetchWeather();
        });
    </script>
    <div id="event-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 w-full max-w-md relative">
            <button id="modal-close-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 transition"><i class="fa-solid fa-xmark fa-2x"></i></button>
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4">Título do Evento</h3>
            <p id="modal-description" class="text-gray-600">Descrição detalhada do evento irá aparecer aqui.</p>
        </div>
    </div>
    <div id="installBanner" class="hidden fixed bottom-4 left-4 right-4 md:right-auto md:left-4 z-50 bg-white border border-gray-300 shadow-xl p-4 rounded-xl flex items-center justify-between max-w-sm mx-auto">
        <span class="text-gray-800 font-medium">Instalar esta app?</span>
        <button id="installBtn" class="ml-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Instalar</button>
    </div>
    <script>
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('service-worker.js').then(() => console.log('Service Worker registado com sucesso!')).catch(error => console.log('Erro ao registar SW:', error)); }
    </script>
    <script>
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installBanner = document.getElementById('installBanner');
            installBanner.classList.remove('hidden');
            document.getElementById('installBtn').addEventListener('click', () => {
                installBanner.classList.add('hidden');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') { console.log('O utilizador aceitou instalar'); } else { console.log('O utilizador recusou instalar'); }
                    deferredPrompt = null;
                });
            });
        });
    </script>
</body>
</html>

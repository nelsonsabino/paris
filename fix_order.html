<!DOCTYPE html>
<html lang="pt">
<head>
    <title>Corretor de Ordem da Checklist</title>
</head>
<body>
    <h1>A corrigir a ordem da checklist...</h1>
    <p>Abra a consola (F12) para ver o progresso.</p>

    <!-- Scripts do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-database-compat.js"></script>

    <script>
        // 1. Configuração do Firebase (a mesma que usa no seu site)
        const firebaseConfig = {
          apiKey: "AIzaSyAt7jAk5r2tqSdyTf2m7MUebd_t7bbDTJk",
          authDomain: "planeamento-viagem-paris.firebaseapp.com",
          databaseURL: "https://planeamento-viagem-paris-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "planeamento-viagem-paris",
          storageBucket: "planeamento-viagem-paris.appspot.com",
          messagingSenderId: "121000897121",
          appId: "1:121000897121:web:75662c01dc56926bf61820"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 2. Script para corrigir a ordem
        const checklistRef = database.ref('checklist');
        
        checklistRef.once('value', (snapshot) => {
            if (!snapshot.exists()) {
                console.log("A checklist está vazia. Nada a fazer.");
                return;
            }

            const items = [];
            // Guarda todos os itens num array para os podermos ordenar
            snapshot.forEach(child => {
                items.push({ key: child.key, ...child.val() });
            });

            // Os IDs do Firebase são baseados no tempo, por isso ao ordená-los
            // obtemos a ordem de criação original.
            items.sort((a, b) => a.key.localeCompare(b.key));

            const updates = {};
            // Cria um novo campo 'order' para cada item, de 0 em diante
            items.forEach((item, index) => {
                console.log(`Item "${item.text}" vai receber a ordem ${index}`);
                updates[item.key + '/order'] = index;
            });

            // Envia todas as atualizações para o Firebase de uma só vez
            checklistRef.update(updates)
                .then(() => {
                    console.log("SUCESSO! A ordem da checklist foi corrigida para todos os " + items.length + " itens.");
                    alert("Ordem corrigida com sucesso!");
                })
                .catch((error) => {
                    console.error("ERRO ao atualizar a ordem:", error);
                    alert("Ocorreu um erro. Verifique a consola.");
                });
        });
    </script>
</body>
</html>
